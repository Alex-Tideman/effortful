<div class="row">
  <div class="col m12">
    <div class="row">
      <div class="col m3">
        <div class="vote-card card green">
          <div class="card-content white-text">
            <div class="card-title white-text">
              <span class="card-title">Voting Results</span>
            </div>
            <div id="voting-results">
              <h6>Yes: <span id="yes-result"><%= @effort.vote.yes %></span></h6>
              <h6>No: <span id="no-result"><%= @effort.vote.no %></span></h6>
              <% if @effort.vote.yes >= @effort.vote.no %>
                  <h5>Result: Success!</h5>
              <% else %>
                  <h5>Result: Next time!</h5>
              <% end %>
            </div>
          </div>
        </div>
      </div>
      <% @effort.sponsors.shuffle.each do |sponsor| %>
          <div class="col m3">
            <div class="vote-card card light-blue">
              <div class="card-content white-text">
                <div class="card-title white-text">
                  <%= image_tag(sponsor.image) %>
                  <span class="card-title"><%= sponsor.name %></span>
                </div>
                <p>Time Remaining to Vote: <%= @effort.vote_remaining %></p>
                <% if sponsor == current_user %>
                    <div class="vote-buttons">
                      <button id="yes-vote" class="btn-floating btn-large waves-effect waves-light green" data-id=<%= @effort.vote.id%> >YES</button>
                      <button id="no-vote" class="btn-floating btn-large waves-effect waves-light red" data-id=<%= @effort.vote.id %>>NO</button>
                    </div>
                <% end %>
              </div>
            </div>
          </div>
      <% end %>
    </div>
  </div>
</div>
<script>
  $(document).ready(function(){
    $('#yes-vote').on('click', function(){
      var vote_params = { vote: { id: $(this).attr("data-id"), type: "yes" } }

      $.ajax({
        type:    "PUT",
        url:     "/votes/" + $(this).attr("data-id"),
        data:    vote_params,
        success: function(){
          $("html").load("#voting-results" );
          $(this.parent()).text("You voted Yes!");
        }
      })
    })

    $('#no-vote').on('click', function(){
      var vote_params = { vote: { id: $(this).attr("data-id"), type: "no" } }

      $.ajax({
        type:    "PUT",
        url:     "/votes/" + $(this).attr("data-id"),
        data:    vote_params,
        success: function(){
          $("html").load("#voting-results");
          $(this.parent()).text("You voted No");
        }
      })
    })
  })
</script>